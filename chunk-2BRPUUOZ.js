import{a as O}from"./chunk-G5KA7DMQ.js";import{a as M}from"./chunk-V6KGQEPR.js";import{a as y}from"./chunk-T32ATWVE.js";import"./chunk-EMUXDAZT.js";import{Ba as p,Ma as a,Na as g,Z as s,ca as f,ea as u,ia as m,ib as _,jb as S,mb as C,sa as c,ta as r,ua as o,va as h,wa as v,xa as x}from"./chunk-QQJZZCOM.js";function F(n,t){if(n&1&&(r(0,"td"),a(1),o()),n&2){let e=p(3);s(),g(e.averageSessionTime)}}function D(n,t){if(n&1&&(r(0,"td"),a(1),o()),n&2){let e=p().$implicit;s(),g(e.value)}}function $(n,t){if(n&1&&(r(0,"tr")(1,"td",14),a(2),o(),m(3,F,2,1,"td",12)(4,D,2,1,"td",12),o()),n&2){let e=t.$implicit;s(2),g(e.stat),s(),c("ngIf",e.stat==="Average Session Time"),s(),c("ngIf",e.stat==="Total Visitors")}}function N(n,t){if(n&1&&(v(0),m(1,$,5,3,"tr",13),x()),n&2){let e=p();s(),c("ngForOf",e.statistics)}}function j(n,t){n&1&&(r(0,"tr")(1,"td",15),a(2,"No visitor statistics to display."),o()())}var P=class n{constructor(t,e){this.visitorSessionService=t;this.auth=e}statistics=[];isUserAdminOrStaff=!1;ngOnInit(){this.isUserAdminOrStaff=this.checkRoles(),this.isUserAdminOrStaff?(this.getTotalVisitors(),this.getAverageSessionTime(),console.log("User is admin/staff. Displaying visitor statistics.")):console.log("User is not admin/staff. No statistics to display.")}checkRoles(){let t="http://schemas.microsoft.com/ws/2008/06/identity/claims/role",e=this.auth.getAccessToken();if(!e||typeof e!="string"||e.trim()==="")return!1;try{let d=O(e)[t];return d==="Admin"||d==="Staff"}catch(i){return console.error("Error decoding token:",i),!1}}averageSessionTime=0;getTotalVisitors(){this.visitorSessionService.getTotalVisitors().subscribe({next:t=>{t&&t.totalVisitors!==void 0?this.statistics.push({stat:"Total Visitors",value:t.totalVisitors}):console.error("Invalid response for total visitors:",t)},error:t=>{console.error("Error fetching total visitors:",t)}})}getAverageSessionTime(){this.visitorSessionService.getAverageSessionTime().subscribe({next:t=>{let i=t.averageSessionTime.split(":"),d=parseInt(i[0],10),T=parseInt(i[1],10),b=i[2].split("."),w=parseInt(b[0],10),I=parseInt(b[1],10),l=d*3600+T*60+w+I/1e3,V=Math.floor(l/3600),k=Math.floor(l%3600/60),A=Math.floor(l%60),E=Math.round(l%1*1e3);this.averageSessionTime=`${this.formatTime(V)}:${this.formatTime(k)}:${this.formatTime(A)}.${E}`,this.statistics.push({stat:"Average Session Time",value:this.averageSessionTime})},error:t=>{console.error("Error fetching average session time:",t)}})}formatTime(t){return t<10?`0${t}`:`${t}`}static \u0275fac=function(e){return new(e||n)(f(y),f(M))};static \u0275cmp=u({type:n,selectors:[["app-visitor"]],decls:20,vars:2,consts:[[1,"container-fluid","py-4"],[1,"row","justify-content-center"],[1,"col-lg-8","col-md-10"],[1,"card","shadow-lg","border-0","rounded-lg"],[1,"card-header","bg-primary","text-white","text-center","py-4","rounded-top"],[1,"mb-0"],[1,"fas","fa-chart-line","me-2"],[1,"card-body","p-4"],[1,"table-responsive"],[1,"table","table-striped","table-hover","table-sm"],[1,"table-primary"],["scope","col"],[4,"ngIf"],[4,"ngFor","ngForOf"],[1,"fw-bold"],["colspan","2",1,"text-center","text-muted"]],template:function(e,i){e&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h5",5),h(6,"i",6),a(7,"Visitor Statistics"),o()(),r(8,"div",7)(9,"div",8)(10,"table",9)(11,"thead",10)(12,"tr")(13,"th",11),a(14,"Statistic"),o(),r(15,"th",11),a(16,"Value"),o()()(),r(17,"tbody"),m(18,N,2,1,"ng-container",12)(19,j,3,0,"tr",12),o()()()()()()()()),e&2&&(s(18),c("ngIf",i.statistics.length>0),s(),c("ngIf",i.statistics.length===0))},dependencies:[C,_,S],styles:['.main-content[_ngcontent-%COMP%]{flex-grow:1;padding:30px;background-color:#fff;margin:20px;border-radius:8px;box-shadow:0 4px 10px #0000000d;width:279%!important;position:absolute;left:109%;top:40%}.card[_ngcontent-%COMP%]{width:242%;height:181%;position:relative;top:55%}.main-content[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{color:#2c3e50;margin-bottom:25px;font-size:2em;border-bottom:1px solid #eee;padding-bottom:15px}.users-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;margin-top:20px;border-radius:8px;overflow:hidden}.users-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .users-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:12px 95px;text-align:left;border-bottom:1px solid #ddd}.users-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#f2f2f2;color:#555;font-weight:700;text-transform:uppercase}.users-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#f5f5f5}.users-table[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:#3498db;color:#fff;border:none;padding:8px 12px;border-radius:5px;cursor:pointer;margin-left:5px;transition:background-color .3s ease}.users-table[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   .delete-btn[_ngcontent-%COMP%]{background-color:#e74c3c}@media (min-width: 768px){.users-table[_ngcontent-%COMP%]{border:0}.users-table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{border:1px solid #ddd;display:block;margin-bottom:1.5rem;border-radius:8px;overflow:hidden;box-shadow:0 2px 5px #0000001a;background-color:#fff}.users-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-bottom:1px solid #ddd;display:block;position:relative;font-size:.9em}.users-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:before{content:attr(data-label);position:absolute;left:0;width:45%;padding-left:15px;font-weight:700;text-align:left;color:#6c757d}.users-table[_ngcontent-%COMP%]   td.d-flex.gap-3[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;align-items:center;padding:12px 15px;border-bottom:none}.users-table[_ngcontent-%COMP%]   td.d-flex.gap-3[_ngcontent-%COMP%]:before{content:"Actions:";left:0;width:45%;padding-left:15px;font-weight:700;text-align:left;color:#6c757d}}']})};export{P as Vistors};
